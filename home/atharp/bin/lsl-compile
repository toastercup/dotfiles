#!/bin/bash

set -euo pipefail

function show_help() {
    echo "lsl-compile usage"
    echo ""
    echo "    lsl-compile <env-file> <main-file>"
    echo ""
    exit 1
}

if [ "$#" -lt 2 ]; then
    echo "not enough arguments"
    show_help
fi

declare -r ENV_FILE_REALPATH=$(realpath "$1")
declare -r MAIN_FILE_REALPATH=$(realpath "$2")

declare -r LSL_INPUT=$(cat <<EOF
#include "$ENV_FILE_REALPATH"
#include "$MAIN_FILE_REALPATH"
EOF
)

lsl-pyoptimizer --bom -p gcpp <(echo -e "$LSL_INPUT")
